<!doctype html>
<html ng-app="myApp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Template</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

	<!-- markdown -->
	<link href="css/plugins/bootstrap-markdown/bootstrap-markdown.min.css" rel="stylesheet">

	<!-- Angular -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/angular-xeditable/0.8.0/css/xeditable.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-xeditable/0.8.0/js/xeditable.min.js"></script>
</head>
<body class="">
    <div id="wrapper">
	<!-- left wrapper -->
	<?php include 'leftWrapper.php'; ?>
	<!-- /end left wrapper -->
	<div id="page-wrapper" class="gray-bg">
		<div class="row border-bottom">
				 <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">
				<!-- top wrapper -->
				<?php include 'topWrapper.php'; ?>
				<!-- / top wrapper -->
				</nav>
		</div>	
		
<!-- content -->
		<div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2>Promote a Blog Post: "<span id="campaignname"></span>"</h2>
                <!--<ol class="breadcrumb">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a>Launch a Campaign</a>
                    </li>
                    <li>
                        <strong><a>Promote a Blog Post</a></strong>
                    </li>
                    
                </ol>-->
            </div>
            <!--<div class="col-lg-2">

            </div>-->
        </div>
        <div class="row" ng-controller="myCtrl">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <!--<div class="ibox-title">
                            <h5>All I Need Are A Few Details <small>... and we'll be ready to rock.</small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li><a href="#">Config option 1</a>
                                    </li>
                                    <li><a href="#">Config option 2</a>
                                    </li>
                                </ul>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>-->
                        <div class="ibox-content">
								<!--<input type="hidden" ng-model="userinfo.firstname">
								<input type="hidden" ng-model="userinfo.lastname">
								<input type="hidden" ng-model="userinfo.username">
								<input type="hidden" ng-model="userinfo.email">
								<input type="hidden" ng-model="userinfo.pass">
                                <div class="form-group"><label class="col-sm-2 control-label">Your Campaign's Name</label>
                                    <div class="col-sm-10"><h2>{{campaign_name}}</h2>
                                    <!--
                                    <input type="text" class="form-control" placeholder="My awesome first campaign" name="campaign_name" value="{{campaign_name}}">
                                    
                                    <span class="help-block m-b-none"></span></div>
                                    
                                </div>
                                <div class="hr-line-dashed"></div>-->
                                <div class="form-group"><label class="col-sm-2 control-label">From Email</label>
                                    <div class="col-sm-10"><input type="text" class="form-control" id="FromEmail" ng-model="campaign.EML1.FromEmail" placeholder="you@something.com" ><span class="help-block m-b-none">The email you're sending from (and to which people will reply).</span>
                                    </div>
                                </div>
								<div class="form-group"><label class="col-sm-2 control-label">From Email Name</label>
                                    <div class="col-sm-10"><input type="text" class="form-control" id="FromName" ng-model="campaign.EML1.FromName" placeholder="Bill Gates"><span class="help-block m-b-none">What do they call you?</span>
                                    </div>
                                </div>
								<div class="form-group"><label class="col-sm-2 control-label">Email Subject Line</label>
                                    <div class="col-sm-10"><input type="text" class="form-control" id="Subject" ng-model="campaign.EML1.Subject" placeholder="You want some cool stuff?"><span class="help-block m-b-none">This is what appears in your recipient's inbox. Make it snappy.</span>
                                    </div>
                                </div>
                                <input type="hidden" ng-model="campaign.EML1.ReplyTo" value="{{campaign.EML1.FromEmail}}">
                                
                                <div class="tab-content">
                                <div id="tab-1" class="tab-pane active">
                                    <div class="panel-body">
                                </div>
                                </div>
                                </div>

                                <div class="form-group"><label class="col-sm-2 control-label">Email Body</label>
                                    <div class="col-sm-10">
                                        <div>
                                        <textarea data-provide="markdown"  id="BodyHtml" ng-model="campaign.EML1.BodyHtml"></textarea>
                                        </div>
										{{campaign.EML1.BodyHtml}}
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-4 col-sm-offset-2">
                                        <button class="btn btn-danger" type="submit" name="action" value="sendTest">Send a Test to Me Now</button></a>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>
                                <!--
                                <div class="hr-line-dashed"></div>
                                <div class="form-group"><label class="col-sm-2 control-label">Send to Who?</label>

                                    <div class="col-sm-10"><select class="form-control m-b" name="account">
                                        <option>All Printers (Leads & Contacts) [16,374]</option>
                                        <option>All Enterprise Accounts [4,123]</option>
                                        <option>Mary and Joe's Opps [343]</option>
                                        <option>MindFire Staff [38]</option>
                                    </select>

                                        
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-sm-2 control-label">Schedule</label>
                                    <div class="col-sm-10">
                                        <div class="table-responsive">
                                            <table class="table table-stripped table-bordered">

                                                <thead>
                                                <tr>
                                                    <th>
                                                        Group
                                                    </th>
                                                    <th>
                                                        Quantity
                                                    </th>
                                                    <th style="width: 20%">
                                                        Send Date/Time
                                                    </th>
                                                    <th>
                                                        Actions
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td>
                                                        <select class="form-control" >
                                                            <option selected>Everyone in my selected Lists(s)</option>
                                                            <option>Non-Opens</option>
                                                            <option>Non-Clickers</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" placeholder="16,374">
                                                    </td>
                                                    <td>
                                                        <div class="input-group date">
                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" class="form-control" value="07/01/2014">
                                                        </div>
                                                    </td>
                                                    <td>
                                                            <button class="btn btn-white"><i class="fa fa-trash"></i> </button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <select class="form-control" >
                                                            <option>Everyone in my selected Lists(s)</option>
                                                            <option selected>Non-Opens</option>
                                                            <option>Non-Clickers</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" placeholder="TBD">
                                                    </td>
                                                    <td>
                                                        <div class="input-group date">
                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" class="form-control" value="07/03/2014">
                                                        </div>
                                                    </td>
                                                    <td>
                                                            <button class="btn btn-white"><i class="fa fa-trash"></i> </button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <select class="form-control" >
                                                            <option></option>Everyone in my selected Lists(s)</option>
                                                            <option>Non-Opens</option>
                                                            <option selected>Non-Clickers</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" placeholder="TBD">
                                                    </td>
                                                    <td>
                                                        <div class="input-group date">
                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" class="form-control" value="07/10/2014">
                                                        </div>
                                                    </td>
                                                    <td>
                                                            <button class="btn btn-white"><i class="fa fa-trash"></i> </button>
                                                    </td>
                                                </tr>
                                                

                                                </tbody>

                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>
                                -->
                                <div class="form-group">
                                    <div class="col-sm-4 col-sm-offset-2">
    								    <input type="hidden" name="URL-PABP-EML1-FROMADDRESS" value="{{STUDIO_ACCOUNTID-STUDIO_PROGRAMID-PABP-EML1-FROMADDRESS}}">
                                        <input type="hidden" name="URL-PABP-EML1-FROMNAME" value="{{STUDIO_ACCOUNTID-STUDIO_PROGRAMID-PABP-EML1-FROMNAME}}">
                                        <input type="hidden" name="programNameHash" value="{{programNameHash}}">
                                        <button class="btn btn-primary" ng-click="Save()">Save</button>
                                        <button class="btn btn-white" type="submit">Cancel</button>

                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
            </div>        

<!--/ content -->           
			<div class="footer">
				<?php include 'footer.php'; ?>
			</div>
		</div><!--  end page-wrapper -->
</div>

    <!-- Mainly scripts -->	
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

	<!-- Bootstrap markdown -->
    <script src="js/plugins/bootstrap-markdown/bootstrap-markdown.js"></script>
    <script src="js/plugins/bootstrap-markdown/markdown.js"></script>

    <!-- Page-Level Scripts -->
	<script type="text/JavaScript" src="global.js?n=1"></script> 
	<script src="js/jquery.md5.js"></script>
    <script>
		var action = getParameterByName("action");
		var campaignName = getParameterByName("campaign_name");
		var campaignID = getParameterByName("campaignID");
		function getParameterByName(name){
		  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		  var regexS = "[\\?&]" + name + "=([^&#]*)";
		  var regex = new RegExp(regexS);
		  var results = regex.exec(window.location.search);
		  if(results == null)
			return "";
		  else
			return decodeURIComponent(results[1].replace(/\+/g, " "));
		}

        $(document).ready(function() {
			$("#campaignname").text(campaignName);
        });

		var accountProfile = {
			"firstname" : "John",
			"lastname" : "Sample",
			"username" : "johnsample",
			"email" : "johnsample@example.com",
			"pass" : "password",
		};
		var myApp = angular.module('myApp', ["xeditable"]);
		myApp.controller('myCtrl',function($scope,$http) {
			$scope.Save = function() {
				//$scope.userinfo = userProfile;
				/*var campaignID = $.md5(campaignName);
				var today = new Date();
				var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
				var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
				var createDate = date+' '+time;
				var item = [];
				item.push({"ID":campaignID,"AccountID":"","Title":campaignName,"CreateDate":createDate,"LastEditDate":createDate,"Status":"Edit"});
				var campaignlist = {"items":item};
				$http.put('/couchdb/' + accountProfile.username +'/campaignlist', campaignlist).then(function(response){
					  //$scope.campaignlist = response.campaignlist;                  
					  alert("Save Campaign List Successful.");
				});*/
				//var EML1 = {"Name":"EML1","Subject":$("#Subject").val(),"FromName":$("#FromName").val(),"FromEmail":$("#FromEmail").val(),"ReplyTo":$("#FromEmail").val(),"BodyHtml":$("#BodyHtml").val()};
				//var campaign = {"GUID":campaignID,"accountID":"","publishProgramName":campaignName,"publishDate":"","EML1":EML1};
				//$scope.campaign.EML1.BodyHtml = $("#BodyHtml").val();
				$http.put('/couchdb/' + accountProfile.username +'/'+campaignID, $scope.campaign).then(function(response){
					  //$scope.campaignlist = response.campaignlist;                  
					  alert("Save Campaign Successful.");
				});
			};
			$scope.Reset = function() {
                  $scope.campaign  = angular.copy($scope.master);
				  //$("#BodyHtml").summernote('pasteHTML', $scope.campaign.EML1.BodyHtml);
            };
			$scope.Load = function() {
                $http.get("/couchdb/" + accountProfile.username +'/'+campaignID).then(function(response) {
                     $scope.master  = response.data; 
                     $scope.Reset();
                });
            };
			
			if (action=="editCampaign") {
				$scope.Load();
				//$("#campaignname").text($scope.campaign.campaignName);
				//$("#BodyHtml").val($scope.campaign.EML1.BodyHtml);
			}
		});
    </script>

</body>

</html>